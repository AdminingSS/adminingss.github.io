!function(e,s,r){function n(e,s){"use strict";if(void 0===e||null===e)throw new TypeError("Cannot convert first argument to object");for(var r=Object(e),n=1;n<arguments.length;n++){var a=arguments[n];if(void 0!==a&&null!==a)for(var i=Object.keys(Object(a)),t=0,o=i.length;t<o;t++){var u=i[t],p=Object.getOwnPropertyDescriptor(a,u);void 0!==p&&p.enumerable&&(r[u]=a[u])}}return r}function a(e){for(var s="=".repeat((4-e.length%4)%4),r=(e+s).replace(/\-/g,"+").replace(/_/g,"/"),n=window.atob(r),a=new Uint8Array(n.length),i=0;i<n.length;++i)a[i]=n.charCodeAt(i);return a}function i(e,s){var r=new Date((new Date).getTime()+1e3*s);document.cookie="swReg_delay="+e+"; path=/; expires="+r.toUTCString()}function t(){var e=o("swReg_delay");return e&&h("Delay:",e),e}function o(e){var s=document.cookie.match(new RegExp("(?:^|; )"+e.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return s?decodeURIComponent(s[1]):void 0}function u(e,s){h("Send for "+e+"...");var r=this,n=this.webPush_params.backend+"/subscription/"+this.webPush_params.fid,a=JSON.stringify({action:e,info:s,list:this.webPush_params.list||"",dk:this.webPush_params.dk||{},"member.email":this.webPush_params["member.email"],swstate:p}),i=new XMLHttpRequest;try{i.open("POST",n,!0),i.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),i.onreadystatechange=function(){if(i.readyState===XMLHttpRequest.DONE&&200===i.status){var s=JSON.parse(i.responseText);h("OK",s),r.webPush_params.ok="subscribe"===e}},i.send(a)}catch(t){console.error("Sending error: "+n,t)}}var p="current",c="ver. 05.02.2019 /11ko+2",h=function(){e.sndsyApi.log.apply(e.sndsyApi,arguments)},d=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)};e.sndsyApi=e.sndsyApi||{},e.sndsyApi=n(e.sndsyApi,{setDevMode:e.sndsyApi.setDevMode||function(e){var s=e||!0;"undefined"!=typeof localStorage&&localStorage[s?"setItem":"removeItem"]("sndsyApi_developMode",1),this.isDevMode=s},log:e.sndsyApi.log||function(){if(this.isDevMode)for(var e=0;e<arguments.length;e+=1)console.log(arguments[e])},isDevMode:e.sndsyApi.isDevMode||function(){return localStorage.getItem("sndsyApi_developMode")||!1}(),webPush_version:c,webPush_params:e.sndsyApi.webPush_params||{}}),n(e.sndsyApi,{webPush_init:function(e){var s=this,r="ServiceWorker ";return"serviceWorker"in navigator&&"PushManager"in window?void(t()||navigator.serviceWorker.getRegistration().then(function(n){var a=Promise.resolve();if(n)if(n.active){var i=new URL(n.active.scriptURL).pathname;i!==(e.sw||"/sendsay_push_sw.js")&&(a=n.unregister(),swstat="replace_active")}else a=n.unregister(),swstat="replace_inactive";else swstat="new";a.then(function(){h(r+c,"Push is supported"),s.webPush_params={fid:e.fid,app_server_key:e.app_server_key,backend:e.backend||"https://sendsay.ru/backend/push",sw:e.sw||"/sendsay_push_sw.js",delay:e.delay||300,list:e.list||null,ok:null},navigator.serviceWorker.register(s.webPush_params.sw).then(function(e){h(r+"is registered",e),s.webPush_params.swReg=e,s.webPush_params.swReg.pushManager.getSubscription().then(function(e){s.webPush_params.ok=!(null===e)})})["catch"](function(e){console.error(r+"error",e),s.webPush_params.err=1})})})["catch"](function(e){console.error(r+"error",e),s.webPush_params.err=1})):void console.warn(r+this.webPush_version,"Push is not supported")},webPush_subscribe:function(){if(!t()){var e=this;if(this.webPush_params.ok)return h("Already subscribed"),void i("subscribed",e.webPush_params.delay);if(!(e.webPush_params.err||e.webPush_params.swReg&&null!==e.webPush_params.ok))return h("check",e.webPush_params),e.webPush_params.s||(e.webPush_params.s=1e3),e.webPush_params.s=2*e.webPush_params.s,void setTimeout(function(){e.webPush_subscribe()},e.webPush_params.s);var s=a(e.webPush_params.app_server_key);e.webPush_params.swReg.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:s}).then(function(s){u.apply(e,["subscribe",s])})["catch"](function(s){h("Subscribe fail:",s),i("denial",e.webPush_params.delay)})}},webPush_isSubscribed:function(){return"undefined"!=typeof this.webPush_params.ok?this.webPush_params.ok:void 0},webPush_addData:function(e){e["member.email"]&&("undefined"==typeof this.webPush_params["member.email"]&&(this.webPush_params["member.email"]=[]),this.webPush_params["member.email"].push(e["member.email"]),delete e["member.email"]),this.webPush_params.dk=n({},this.webPush_params.dk,e)},webPush_unsubscribe:function(){var e=this;this.webPush_params.swReg.pushManager.getSubscription().then(function(s){if(s)return s.unsubscribe().then(function(r){u.apply(e,["unsubscribe",s])})["catch"](function(e){console.error("Error unsubscribing(2): ",e)})})["catch"](function(e){console.error("Error unsubscribing",e)}).then(function(){e.webPush_params.ok||h("User is unsubscribed.")})}}),"undefined"!=typeof e.sendsay_push&&d(e.sendsay_push.q)&&e.sendsay_push.q.forEach(function(s,r){var n="webPush_"+s[0];e.sndsyApi.log("[call function] from sndsyApi.wpq: "+n,s),e.sndsyApi[n].apply(e.sndsyApi,[s[1]||void 0])}),e.sndsyApi.wpq&&d(e.sndsyApi.wpq)&&e.sndsyApi.wpq.forEach(function(s,r){var n="webPush_"+s[0];e.sndsyApi.log("[call function] from sndsyApi.wpq: "+n,s),e.sndsyApi[n].apply(e.sndsyApi,[s[1]||void 0])}),e.sendsay_push=function(){return e.sndsyApi["webPush_"+arguments[0]].apply(e.sndsyApi,[arguments[1]||void 0])}}(window,document,"webPush_params");